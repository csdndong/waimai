{itemplate 'public/header'}
<div class="page clearfix config-notice-phonic">
	<h2>商家app设置 <small class="text-danger">(此功能需要购买商家APP才能使用)</small></h2>
	<form class="form-horizontal form form-validate" id="form1" action="" method="post" enctype="multipart/form-data">
		<input type="hidden" name="form_type" value="setting_app">
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">app序列号</label>
			<div class="col-sm-9 col-xs-12">
				<input type="text" name="manager[serial_sn]" value="{$app['serial_sn']}" class="form-control" required="true"/>
				{if $_W['isfounder'] == 1}<div class="help-block">请联系模块开发者获取</div>{/if}
			</div>
		</div>
		<div class="form-group hide">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">商家APP版本号</label>
			<div class="col-sm-9 col-xs-12">
				<div class="input-group">
					<div class="input-group-addon">版本号</div>
					<input type="text" name="manager[version][android]" value="{$app['version']['android']}" class="form-control" required="true"/>
				</div>
				<div class="help-block">app版本号， 必须和最新apk的versionCode 一致，否则无法进行app更新。如果您不了解该配置，请勿修改.</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">IOS版本打包方式</label>
			<div class="col-sm-9 col-xs-12">
				<div class="radio radio-inline">
					<input type="radio" value="0" name="manager[ios_build_type]" id="manager-ios-build-type-0" {if !$app['ios_build_type']}checked{/if}>
					<label for="manager-ios-build-type-0">官方统一打包</label>
				</div>
				<div class="radio radio-inline">
					<input type="radio" value="1" name="manager[ios_build_type]" id="manager-ios-build-type-1" {if $app['ios_build_type'] == 1}checked{/if}>
					<label for="manager-ios-build-type-1">自定义打包</label>
				</div>
				<div class="help-block">
					如果您没有苹果开发者账号, 你可以选择"官方统一打包"方式。<br>
					如果您已经在苹果商店上架了官方给你打包的商家app,请选择"自定义打包"
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">极光推送key</label>
			<div class="col-sm-9 col-xs-12">
				<input type="text" name="manager[push_key]" value="{$app['push_key']}" class="form-control" required="true"/>
				<div class="help-block"></div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">极光推送Secret</label>
			<div class="col-sm-9 col-xs-12">
				<input type="text" name="manager[push_secret]" value="{$app['push_secret']}" class="form-control" required="true"/>
				<div class="help-block"></div>
			</div>
		</div>
		<div class="form-group hide">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">讯飞语音合成-安卓端appid</label>
			<div class="col-sm-9 col-xs-12">
				<input type="text" name="manager[xunfei_Android_appid]" value="{$app['xunfei_Android_appid']}" class="form-control" required="true"/>
				<div class="help-block">可不填。如果不填，将使用官方的公用appid。如果你填写，请保证appid的准确性，否则会造成app有消息推送，但是没有语音提醒的问题</div>
			</div>
		</div>
		<div class="form-group hide">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">讯飞语音合成-苹果appid</label>
			<div class="col-sm-9 col-xs-12">
				<input type="text" name="manager[xunfei_ios_appid]" value="{$app['xunfei_ios_appid']}" class="form-control" required="true"/>
				<div class="help-block">可不填。如果不填，将使用官方的公用appid。如果你填写，请保证appid的准确性，否则会造成app有消息推送，但是没有语音提醒的问题</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">IOS版商家App下载地址链接</label>
			<div class="col-sm-9 col-xs-12">
				<input type="text" name="manager[ios_download_link]" value="{$app['ios_download_link']}" class="form-control"/>
				<div class="help-block">注意:只有商家APP在苹果商城审核通过并且上架后请将下载地址链接复制到此处</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">Android商家App下载地址</label>
			<div class="col-sm-9 col-xs-12">
				<p class="form-control-static">安卓版本：<a href="{$downurls['manager']['android']}" target="_blank">{$downurls['manager']['android']}</a></p>
				<p class="form-control-static hide">苹果版本：<a href="{$downurls['manager']['ios']}" target="_blank">{$downurls['manager']['ios']}</a></p>
				{if !file_exists($downurls['manager']['apk'])}
					<div class="text-danger">apk安装包未上传到服务器</div>
				{/if}
				<div class="help-block">下载之前,请确保已经将apk上传到服务器</div>
				<!-- <div class="panel panel-default panel-app-qrcode">
					<div class="panel-heading">安卓版本下载</div>
					<div class="panel-body">
						<div class="qrcode-block js-qrcode" data-text="{$downurls['manager']['android']}"></div>
					</div>
				</div> -->
				<div class="panel panel-default panel-app-qrcode hide">
					<div class="panel-heading">IOS版本下载</div>
					<div class="panel-body">
						<img width="180" src="{php echo $_W['siteroot'] .  'web/' . url('utility/wxcode/qrcode', array('text' => $downurls['manager']['ios']));}">
					</div>
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">商户App下载地址</label>
			<div class="col-sm-9 col-xs-12">
				<p class="form-control-static"><a href="javascript: ;" class="js-clip" data-href="{php echo ivurl('/pages/public/dowload/appManager', array(), true);}">{php echo ivurl('/pages/public/dowload/appManager', array(), true);}</a></p>
				<div class="panel panel-default panel-app-qrcode">
					<div class="panel-heading">应用下载</div>
					<div class="panel-body">
						<div class="qrcode-block js-qrcode" data-text="{php echo ivurl('/pages/public/dowload/appManager', array(), true);}"></div>
					</div>
				</div>
			</div>
		</div>
		<h2>语音提醒</h2>
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">新订单提醒</label>
			<div class="col-sm-9 col-xs-12">
				<input type="file" name="new" value="{$app['phonic']['new']}">
				{if !empty($app['phonic']['new'])}
				<div class="audio-container">
					<div class="audio-msg">
						<div class="icon audio-player-play" data-attach="{WE7_WMALL_URL}{$path}{$app['phonic']['new']}?t={php echo time();}"><span><i class="fa fa-play"></i></span></div>
					</div>
				</div>
				{/if}
				<div class="help-block">
					{if !empty($app['phonic']['new'])}当前语音文件:{$app['phonic']['new']}{/if}
					<span>。注意：仅支持MP3格式的语音文件</span>
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">催单提醒</label>
			<div class="col-sm-9 col-xs-12">
				<input type="file" name="remind" value="{$app['phonic']['remind']}">
				{if !empty($app['phonic']['remind'])}
				<div class="audio-container">
					<div class="audio-msg">
						<div class="icon audio-player-play" data-attach="{WE7_WMALL_URL}{$path}{$app['phonic']['remind']}?t={php echo time();}"><span><i class="fa fa-play"></i></span></div>
					</div>
				</div>
				{/if}
				<div class="help-block">
					{if !empty($app['phonic']['remind'])}当前语音文件:{$app['phonic']['remind']}{/if}
					<span>。注意：仅支持MP3格式的语音文件</span>
				</div>
			</div>
		</div>
		<div class="form-group">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">退单提醒</label>
			<div class="col-sm-9 col-xs-12">
				<input type="file" name="refund" value="{$app['phonic']['refund']}">
				{if !empty($app['phonic']['refund'])}
				<div class="audio-container">
					<div class="audio-msg">
						<div class="icon audio-player-play" data-attach="{WE7_WMALL_URL}{$path}{$app['phonic']['refund']}?t={php echo time();}"><span><i class="fa fa-play"></i></span></div>
					</div>
				</div>
				{/if}
				<div class="help-block">
					{if !empty($app['phonic']['refund'])}当前语音文件:{$app['phonic']['refund']}{/if}
					<span>。注意：仅支持MP3格式的语音文件</span>
				</div>
			</div>
		</div>
		<div class="form-group hide">
			<label class="col-xs-12 col-sm-3 col-md-2 control-label">订单完成提醒</label>
			<div class="col-sm-9 col-xs-12">
				<input type="file" name="end" value="{$app['phonic']['end']}">
				{if !empty($app['phonic']['end'])}
				<div class="audio-container">
					<div class="audio-msg">
						<div class="icon audio-player-play" data-attach="{WE7_WMALL_URL}{$path}{$app['phonic']['end']}?t={php echo time();}"><span><i class="fa fa-play"></i></span></div>
					</div>
				</div>
				{/if}
				<div class="help-block">
					{if !empty($app['phonic']['end'])}当前语音文件:{$app['phonic']['end']}{/if}
					<span>。注意：仅支持MP3格式的语音文件</span>
				</div>
			</div>
		</div>
		<div class="form-group">
			<div class="col-sm-9 col-xs-9 col-md-9">
				<input type="hidden" name="token" value="{$_W['token']}">
				<input type="submit" value="提交" class="btn btn-primary">
			</div>
		</div>
	</form>
	<h2>APP安装包上传</h2>
	<form class="form-horizontal form form-validate" id="form2" action="" method="post" enctype="multipart/form-data">
		<input type="hidden" name="form_type" value="upload_file">
		<div class="form-group">
			<div class="col-sm-9 col-xs-12">
				<input type="file" name="file" value="" required="true">
			</div>
		</div>
		<div class="form-group">
			<div class="col-sm-9 col-xs-9 col-md-9">
				<input type="hidden" name="token" value="{$_W['token']}">
				<input type="submit" value="提交" class="btn btn-primary">
			</div>
		</div>
	</form>
</div>
<script>
	require(['jquery.jplayer'], function(){
		$(".audio-player-play").click(function(){
			var src = $(this).data("attach");
			if(!src) {
				return;
			}
			if ($("#player")[0]) {
				var player = $("#player");
			} else {
				var player = $('<div id="player"></div>');
				$(document.body).append(player);
			}
			player.data('control', $(this));
			player.jPlayer({
				playing: function() {
					$(this).data('control').find("i").removeClass("fa-play").addClass("fa-stop");
				},
				pause: function (event) {
					$(this).data('control').find("i").removeClass("fa-stop").addClass("fa-play");
				},
				swfPath: "resource/components/jplayer",
				supplied: "mp3,wma,wav,amr",
				solution: "html, flash"
			});
			player.jPlayer("setMedia", {mp3: $(this).data("attach")}).jPlayer("play");
			if($(this).find("i").hasClass("fa-stop")) {
				player.jPlayer("stop");
			} else {
				$('.audio-msg').find('.fa-stop').removeClass("fa-stop").addClass("fa-play");
				player.jPlayer("setMedia", {mp3: $(this).data("attach")}).jPlayer("play");
			}
		});
	});
</script>
{itemplate 'public/footer'}