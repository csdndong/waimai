webpackJsonp([179],{"35Pm":function(t,i){},"7GDZ":function(t,i,o){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=o("Gu7T"),e=o.n(s),a=o("mvHQ"),r=o.n(a),n=o("Dd8w"),c=o.n(n),l=o("NYxO"),d=o("mzkE"),v=o("Cz8s"),u=o("EE5Z"),h={data:function(){return{getLocationFail:!1,showPreLoading:!0,delivery_type:"",title:"全部商家",storeExtra:{condition:{order:"",mode:"",dis:""},filter_title:"综合排序",multiple:!1,filter:!1},stores:{page:1,psize:20,loaded:!1,empty:!1,data:[],loading:!1},discounts:{},orderbys:{},carousel:{},config:{},storeSearch:!1,categorySelectedId:-1,lazyload:{},menufooter:{}}},components:{PublicHeader:v.a,PublicFooter:d.a,StoreGroup:u.a},computed:c()({},Object(l.c)(["locationInfo"])),methods:c()({},Object(l.b)(["setLocation","getLocation"]),{onChangeCategory:function(t){t!=this.categorySelectedId&&(this.categorySelectedId=t,t!=this.cid?this.child_id=t:this.child_id=0,this.onGetStore(!0))},onChangeStoreExtra:function(t){"multiple"==t?(this.storeExtra.multiple=!0,this.storeExtra.filter=!1):(this.storeExtra.multiple=!1,this.storeExtra.filter=!0),this.storeSearch=!0},onLoad:function(){var t=this;this.util.request({url:"wmall/home/search/index",data:{lat:this.locationInfo.location_x,lng:this.locationInfo.location_y,menufooter:1,cid:this.cid,child_id:this.child_id,delivery_type:this.delivery_type,condition:r()(this.storeExtra.condition)}}).then(function(i){t.showPreLoading=!1;var o=i.data.message.message;if((1==t.util.getStorage("itime")||1==t.util.getStorage("jskey"))&&o.stores.stores.length>5){var s=Math.floor(5*Math.random());o.stores.stores=o.stores.stores.slice(2,s)}t.stores.data=[].concat(e()(t.stores.data),e()(o.stores.stores)),o.stores.pagetotal<=t.stores.page&&(t.stores.loaded=!0,t.stores.data.length||(t.stores.empty=!0)),t.stores.page++,t.discounts=o.discounts,t.orderbys=o.orderbys,t.carousel=o.carousel,t.config=o.config,o.carousel&&o.carousel.title&&(t.title=o.carousel.title,t.util.setWXTitle(t.title)),t.lazyload.lazyload_goods=t.config.lazyload_goods,t.lazyload.lazyload_store=t.config.lazyload_store,t.menufooter=window.menufooter})},onGetStore:function(t){var i=this;t&&(this.stores={page:1,psize:20,loaded:!1,empty:0,data:[],loading:!0}),this.util.request({url:"wmall/home/search/store",data:{lat:this.locationInfo.location_x,lng:this.locationInfo.location_y,page:this.stores.page,psize:this.stores.psize,cid:this.cid,child_id:this.child_id,delivery_type:this.delivery_type,condition:r()(this.storeExtra.condition)}}).then(function(o){var s=o.data.message.message;t&&(i.stores.data=[]),i.stores.data=[].concat(e()(i.stores.data),e()(s.stores)),s.pagetotal<=i.stores.page&&(i.stores.loaded=!0,i.stores.data.length||(i.stores.empty=1),i.stores.finished=!0),i.stores.loading=!1,i.stores.page++})},onStoreOrderby:function(t,i,o){if("order"==t)"svipRedpacket"==i?this.storeExtra.condition.dis=i:(this.storeExtra.condition.order=i,this.storeExtra.multiple=!1,this.storeExtra.filter_title="sailed"!=i&&"distance"!=i?o:"综合排序");else if("discounts"==t){if(this.storeExtra.condition.dis==i&&(i=""),this.storeExtra.condition.dis=i,"refresh"!=o)return!1}else{if("mode"==t)return this.storeExtra.condition.mode==i&&(i=""),this.storeExtra.condition.mode=i,!1;"clear"==t?(this.storeExtra.condition.dis="",this.storeExtra.condition.order="",this.storeExtra.condition.mode="",this.storeExtra.filter=!1,this.storeExtra.filter_title="综合排序"):"finish"==t&&(this.storeExtra.filter=!1)}this.storeSearch=!1,this.onGetStore(!0)}}),mounted:function(){var t=this;this.getLocation(),this.locationInfo.location_x?t.onLoad():this.util.getLocation({successLocation:function(i){t.setLocation({location_x:i.location_x,location_y:i.location_y}),t.onLoad()},successAddress:function(i){t.setLocation({location_x:i.location_x,location_y:i.location_y,address:i.address})},fail:function(i){t.getLocationFail=!0,t.onLoad()}})},created:function(){var t=this.util.parseQuery(this.$route.query);this.cid=t.cid,this.categorySelectedId=this.cid,this.child_id=0,t.child_id&&(this.child_id=t.child_id,this.categorySelectedId=this.child_id),this.storeExtra.condition.dis=t.dis,this.delivery_type=t.delivery_type}},_={render:function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("div",{attrs:{id:"category"}},[o("public-header",{attrs:{title:t.title}}),t._v(" "),t.showPreLoading?t._e():o("div",{staticClass:"content"},[t.carousel&&1==t.carousel.slide_status&&t.carousel.slide?o("van-swipe",{staticClass:"swiper",attrs:{autoplay:3e3,"indicator-color":"#ff2d4b"}},t._l(t.carousel.slide,function(i,s){return o("van-swipe-item",{key:s},[o("div",{staticStyle:{height:"100px"},on:{click:function(o){return t.util.jsUrl(i.wxapp_link)}}},[o("img",{attrs:{src:i.thumb,alt:""}})])])}),1):t._e(),t._v(" "),t.carousel&&1==t.carousel.nav_status&&t.carousel.nav?o("van-row",{staticClass:"searchbar "},t._l(t.carousel.nav,function(i,s){return o("div",{on:{click:function(o){return t.util.jsUrl(i.wxapp_link)}}},[o("van-col",{staticClass:"bar-item flex-lr van-hairline--bottom",class:{"van-hairline--right":s%2==0},attrs:{span:"12"}},[o("div",{staticClass:"bar-text"},[o("div",{staticClass:"bar-title"},[t._v(t._s(i.title))]),t._v(" "),o("div",{staticClass:"bar-subtitle"},[t._v(t._s(i.sub_title))])]),t._v(" "),o("div",{staticClass:"bar-img flex"},[o("img",{attrs:{src:i.thumb,alt:""}})])])],1)}),0):t._e(),t._v(" "),t.carousel&&t.carousel.child?o("div",{staticClass:"cate-list-wrap margin-10-t"},[o("ul",{staticClass:"cate-list"},[o("li",{staticClass:"cate-item",class:{active:t.categorySelectedId==t.carousel.id},on:{click:function(i){return t.onChangeCategory(t.carousel.id)}}},[o("div",{staticClass:"img-wrap"},[o("img",{staticClass:"img-100",attrs:{src:t.carousel.thumb,alt:""}})]),t._v(" "),o("div",{staticClass:"cate-title ellipsis"},[t._v("全部")])]),t._v(" "),t._l(t.carousel.child,function(i){return o("li",{key:i.id,staticClass:"cate-item",class:{active:t.categorySelectedId==i.id},on:{click:function(o){return t.onChangeCategory(i.id)}}},[o("div",{staticClass:"img-wrap"},[o("img",{staticClass:"img-100",attrs:{src:i.thumb,alt:""}})]),t._v(" "),o("div",{staticClass:"cate-title ellipsis"},[t._v(t._s(i.title))])])})],2)]):t._e(),t._v(" "),o("div",{staticClass:"diy-store-button-tab van-hairline--bottom van-hairline--top"},[o("div",{staticClass:"col-25",class:{active:t.storeExtra.condition.order&&"sailed"!=t.storeExtra.condition.order&&"distance"!=t.storeExtra.condition.order},on:{click:function(i){return t.onChangeStoreExtra("multiple")}}},[t._v(t._s(t.storeExtra.filter_title)),o("div",{staticClass:"icon icon-unfold"})]),t._v(" "),o("div",{staticClass:"col-25",class:{active:"sailed"==t.storeExtra.condition.order},on:{click:function(i){return t.onStoreOrderby("order","sailed")}}},[t._v("销量最高")]),t._v(" "),o("div",{staticClass:"col-25",class:{active:"distance"==t.storeExtra.condition.order},on:{click:function(i){return t.onStoreOrderby("order","distance")}}},[t._v("离我最近")]),t._v(" "),o("div",{staticClass:"col-25",on:{click:function(i){return t.onChangeStoreExtra("filter")}}},[t._v("\n\t\t\t\t筛选 "),o("i",{staticClass:"icon icon-unfold"}),t._v(" "),t.storeExtra.condition.dis&&t.storeExtra.condition.mode?[o("span",[t._v("2")])]:t.storeExtra.condition.dis&&!t.storeExtra.condition.mode||t.storeExtra.condition.mode&&!t.storeExtra.condition.dis?[o("span",[t._v("1")])]:t._e()],2)]),t._v(" "),o("div",{staticClass:"diy-store-other-condition bg-default font-13 padding-15-lr padding-10-tb"},[o("van-row",{attrs:{gutter:"10"}},[t.config&&1==t.config.is_has_svip?o("van-col",{attrs:{span:"6"}},[o("div",{staticClass:"other-condition-item",class:{active:"svipRedpacket"==t.storeExtra.condition.dis},on:{click:function(i){return t.onStoreOrderby("order","svipRedpacket")}}},[t._v("会员红包")])]):o("van-col",{attrs:{span:"6"}},[o("div",{staticClass:"other-condition-item",class:{active:"mallNewMember"==t.storeExtra.condition.dis},on:{click:function(i){return t.onStoreOrderby("discounts","mallNewMember","refresh")}}},[t._v("首单立减")])]),t._v(" "),o("van-col",{attrs:{span:"6"}},[o("div",{staticClass:"other-condition-item",class:{active:"deliveryFeeDiscount"==t.storeExtra.condition.dis},on:{click:function(i){return t.onStoreOrderby("discounts","deliveryFeeDiscount","refresh")}}},[t._v("减配送费")])]),t._v(" "),t.config&&1==t.config.is_has_zhunshibao?o("van-col",{attrs:{span:"6"}},[o("div",{staticClass:"other-condition-item",class:{active:"zhunshibao"==t.storeExtra.condition.dis},on:{click:function(i){return t.onStoreOrderby("discounts","zhunshibao","refresh")}}},[t._v("赠准时宝")])]):o("van-col",{attrs:{span:"6"}},[o("div",{staticClass:"other-condition-item",class:{active:"couponCollect"==t.storeExtra.condition.dis},on:{click:function(i){return t.onStoreOrderby("discounts","couponCollect","refresh")}}},[t._v("进店领券")])]),t._v(" "),o("van-col",{attrs:{span:"6"}},[o("div",{staticClass:"other-condition-item",class:{active:"discount"==t.storeExtra.condition.dis},on:{click:function(i){return t.onStoreOrderby("discounts","discount","refresh")}}},[t._v("立减优惠")])])],1)],1),t._v(" "),t.getLocationFail?[o("div",{staticClass:"geolocationfail"},[o("img",{attrs:{src:"static/img/store_no_con.png",alt:""}}),t._v(" "),o("p",[t._v("获取定位失败!您可以选择手动搜索地址")]),t._v(" "),o("router-link",{staticClass:"btn-location",attrs:{to:t.util.getUrl({path:"/pages/home/location"})}},[t._v("手动搜索地址")])],1)]:[t.stores.empty?[o("div",{staticClass:"geolocationfail"},[o("img",{attrs:{src:"static/img/store_no_con.png",alt:""}}),t._v(" "),o("p",[t._v("附近没有发现门店,我们正在努力覆盖中")]),t._v(" "),o("router-link",{staticClass:"btn-location",attrs:{to:t.util.getUrl({path:"/pages/home/location"})}},[t._v("切换地址")])],1)]:[t.stores.empty?t._e():o("van-list",{attrs:{finished:t.stores.loaded,offset:100,"immediate-check":!1},on:{load:t.onGetStore},model:{value:t.stores.loading,callback:function(i){t.$set(t.stores,"loading",i)},expression:"stores.loading"}},[o("store-group",{attrs:{stores:t.stores.data,lazyload:t.lazyload}})],1),t._v(" "),t.stores.loaded?o("div",{staticClass:"loaded"},[o("div",{staticClass:"loaded-tips"},[t._v("我是有底线的")])]):t._e()]]],2),t._v(" "),o("van-popup",{staticClass:"popup-search",attrs:{position:"top"},model:{value:t.storeSearch,callback:function(i){t.storeSearch=i},expression:"storeSearch"}},[o("div",{staticClass:"diy-store-button-tab van-hairline--bottom"},[o("div",{staticClass:"col-25",class:{active:t.storeExtra.condition.order&&"sailed"!=t.storeExtra.condition.order&&"distance"!=t.storeExtra.condition.order},on:{click:function(i){return t.onChangeStoreExtra("multiple")}}},[t._v("综合排序")]),t._v(" "),o("div",{staticClass:"col-25",class:{active:"sailed"==t.storeExtra.condition.order},on:{click:function(i){return t.onStoreOrderby("order","sailed")}}},[t._v("销量最高")]),t._v(" "),o("div",{staticClass:"col-25",class:{active:"distance"==t.storeExtra.condition.order},on:{click:function(i){return t.onStoreOrderby("order","distance")}}},[t._v("离我最近")]),t._v(" "),o("div",{staticClass:"col-25",on:{click:function(i){return t.onChangeStoreExtra("filter")}}},[t._v("\n\t\t\t\t筛选\n\t\t\t\t"),t.storeExtra.condition.dis&&t.storeExtra.condition.mode?[o("span",[t._v("2")])]:t.storeExtra.condition.dis&&!t.storeExtra.condition.mode||t.storeExtra.condition.mode&&!t.storeExtra.condition.dis?[o("span",[t._v("1")])]:t._e()],2)]),t._v(" "),t.storeExtra.filter?[o("div",{staticClass:"scroll"},[o("div",{staticClass:"new-search-list"},[o("div",{staticClass:"new-search-title"},[t._v("配送服务")]),t._v(" "),o("div",{staticClass:"new-search-group"},[o("div",{staticClass:"new-search-item"},[o("div",{staticClass:"info",class:{active:2==t.storeExtra.condition.mode},on:{click:function(i){return t.onStoreOrderby("mode",2)}}},[o("i",{staticClass:"icon icon-waimai"}),t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.config.delivery_title)+"\n\t\t\t\t\t\t\t")])]),t._v(" "),o("div",{staticClass:"new-search-item"},[o("div",{staticClass:"info",class:{active:1==t.storeExtra.condition.mode},on:{click:function(i){return t.onStoreOrderby("mode",1)}}},[o("i",{staticClass:"icon icon-waimai"}),t._v("\n\t\t\t\t\t\t\t\t商家自送\n\t\t\t\t\t\t\t")])])])]),t._v(" "),o("div",{staticClass:"new-search-list"},[o("div",{staticClass:"new-search-title"},[t._v("优惠活动 (单选)")]),t._v(" "),o("div",{staticClass:"new-search-group"},t._l(t.discounts,function(i,s){return o("div",{key:s,staticClass:"new-search-item",on:{click:function(o){return t.onStoreOrderby("discounts",i.key)}}},[o("div",{staticClass:"info",class:{active:t.storeExtra.condition.dis==i.key}},[o("img",{attrs:{src:"static/img/"+i.key+"_b.png",alt:""}}),t._v("\n\t\t\t\t\t\t\t\t"+t._s(i.title)+"\n\t\t\t\t\t\t\t")])])}),0)])]),t._v(" "),o("div",{staticClass:"search-btn van-hairline--top"},[o("div",{staticClass:"search-btn-left",on:{click:function(i){return t.onStoreOrderby("clear")}}},[t._v("清除筛选")]),t._v(" "),o("div",{staticClass:"search-btn-right",on:{click:function(i){return t.onStoreOrderby("finish")}}},[t._v("完成")])])]:t._e(),t._v(" "),t.storeExtra.multiple?[o("van-cell-group",t._l(t.orderbys,function(i,s){return o("van-cell",{key:s,on:{click:function(o){return t.onStoreOrderby("order",i.key,i.title)}}},[o("div",{staticClass:"active-list-item flex",attrs:{slot:"title"},slot:"title"},[o("div",{staticClass:"icon",class:{"icon-waimai":"waimai"==i.icon,"icon-location":"location"==i.icon,"icon-hot_light":"hot_light"==i.icon,"icon-favor1":"favor1"==i.icon,"icon-moneybag":"moneybag"==i.icon,"c-danger":t.storeExtra.condition.order==i.key}}),t._v(" "),o("span",{class:{"c-danger":t.storeExtra.condition.order==i.key}},[t._v(t._s(i.title))])]),t._v(" "),o("div",{staticClass:"icon",class:{"c-danger":t.storeExtra.condition.order==i.key,"icon-check":t.storeExtra.condition.order==i.key},attrs:{slot:"right-icon"},slot:"right-icon"})])}),1)]:t._e()],2),t._v(" "),o("public-footer",{attrs:{preLoading:t.showPreLoading,menufooter:t.menufooter}})],1)},staticRenderFns:[]};var f=o("VU/8")(h,_,!1,function(t){o("35Pm")},null,null);i.default=f.exports}});
//# sourceMappingURL=179.af22dcff1866c63f97e9.js.map