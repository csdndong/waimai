webpackJsonp([3],{"2NjV":function(t,e,s){"use strict";s.d(e,"a",function(){return c});var i=s("Gu7T"),a=s.n(i),r=s("woOf"),n=s.n(r),o=s("YaEn");function c(t){var e=t.type;if("delivery_transfer"!=e&&"direct_transfer"!=e&&"cancel"!=e){var s=function(t){return{delivery_assign:{tip:"确定抢单吗",success_status:2},direct_transfer_refuse:{tip:"确定拒绝转单吗",success_status:3,reply:"refuse"},direct_transfer_agree:{tip:"确定接受转单吗",success_status:2,reply:"agree"},delivery_instore:{tip:"确定已取货吗",success_status:3},delivery_success:{tip:"确认已送达吗",success_status:4},wx_notice:{tip:"确定通知下单人你已到达送餐地址吗",success_status:0}}[t]}(e),i=s.success_status;"direct_transfer_refuse"!=e&&"direct_transfer_agree"!=e||(e="direct_transfer_reply");var r="delivery/order/errander/status";"wx_notice"==e&&(r="delivery/order/errander/notice");var c={url:r,data:{id:t.order.id,type:e,reply:s.reply||"",code:t.code,_deliveryerOrderTabType:"errander"},confirm:t.code?"":s.tip,success:function(r){if(t.vue.util.$toast(r),"wx_notice"!=e){if("detail"==t.from)"direct_transfer_reply"==e?(t.vue.order.transfer_delivery_status=i,"agree"==s.reply&&(t.vue.order.deliveryer_id=t.vue.order.transfer_deliveryer_id)):t.vue.order.delivery_status=i,t.vue.order=n()({},t.vue.order);else{if("agree"==s.reply)t.vue.records.data[t.index].transfer_delivery_status=i;else if("refuse"==s.reply)t.vue.records.data.splice(t.index,1);else{-1!=["delivery_assign","delivery_instore","delivery_success"].indexOf(e)&&t.vue.records.data.splice(t.index,1)}var o=t.vue.util.getStorage("orderTabs");o&&o.length>0&&(t.vue.tabs=[].concat(a()(o)))}t.code&&(t.vue.code=n()({},{codeShow:!1,value:"",orderIndex:-1}))}},fail:function(e){t.vue.util.$toast(e.message),t.code&&(t.vue.code=n()({},{codeShow:!1,value:"",orderIndex:-1}))}};t.vue.util.jspost(c)}else o.a.push(t.vue.util.getUrl({path:"/pages/paotui/op",query:{order_id:t.order.id,type:e,order_status:t.order.status}}))}},"37pY":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("Cz8s"),a=s("mzkE"),r=s("75NE"),n=s("deIj"),o=s("2NjV"),c={components:{publicHeader:i.a,publicFooter:a.a,countDown:r.a},data:function(){return{tabActive:0,tabs:[{status:1,status_cn:"待抢",num:0},{status:2,status_cn:"待取货",num:0},{status:3,status_cn:"配送中",num:0},{status:4,status_cn:"已完成",num:0}],filter:{items:{status:1}},isRefresh:!1,showPreLoading:!0,records:{page:1,psize:15,loading:!1,finished:!1,empty:!1,data:[]},deliveryer:{},can_collect_order:!1,verification_code:!1,config:{},code:{codeShow:!1,value:"",orderIndex:-1},failedTips:{show:!1,type:"message",tips:"您没有跑腿单的配送权限，请联系平台管理员",btnText:"",link:"",position:"absolute"},menufooter:{},yinsihao:{status:!1,secret_mobile:"",extension:""}}},methods:{onChangeStatus:function(t,e){this.filter.items.status=this.tabs[t].status,this.onLoad(!0)},onLoad:function(t){var e=this;Object(n.b)({vue:e,force:t,url:"delivery/order/errander/list",recordsName:"orders",data:{menufooter:1,_deliveryerOrderTabType:"errander"},success:function(t){e.deliveryer=t.deliveryer,e.can_collect_order=t.can_collect_order,e.verification_code=t.verification_code,e.config=t.config},fail:function(){e.failedTips.show=!0}})},onChangeOrderStatus:function(t,e){("delivery_success"!=e||1!=this.verification_code||(this.code.codeShow=!0,this.code.orderIndex=t,this.code.value))&&Object(o.a)({vue:this,type:e,index:t,from:"list",order:this.records.data[t],code:this.code.value})},onDetail:function(t){1!=this.filter.items.status?this.$router.push(this.util.getUrl({path:"pages/paotui/detail",query:{id:t}})):this.util.$toast("抢单后才能查看详情","",1e3)},onPullDownRefresh:function(){this.onLoad(!0)},onCallCustomer:function(t,e){var s=this;Object(n.a)({vue:s,url:"yinsihao/yinsihao",data:{order_id:t,type:"errander",ordersn:e,orderType:"errander"},success:function(t){s.yinsihao.secret_mobile=t.data.secret_mobile,s.yinsihao.extension=t.data.extension,s.yinsihao.status=!0}})}},mounted:function(){var t=this;t.onLoad(),setInterval(function(){1==t.filter.items.status&&1==t.config.auto_refresh&&t.onLoad(!0)},15e3),this.util.imap(),this.util.icloudapi({vue:t,page:"orderPaotui"})}},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"paotui-list"}},[s("public-header",{attrs:{title:"跑腿订单列表"}}),t._v(" "),s("public-footer",{attrs:{showPreLoading:t.showPreLoading,menufooter:t.menufooter}}),t._v(" "),s("div",{staticClass:"content"},[s("van-tabs",{attrs:{color:"#0EC3B3","title-active-color":"#0EC3B3","title-inactive-color":"#000","line-width":80,"line-height":2,"offset-top":46,sticky:"",swipeable:""},on:{change:t.onChangeStatus},model:{value:t.tabActive,callback:function(e){t.tabActive=e},expression:"tabActive"}},t._l(t.tabs,function(e,i){return s("van-tab",{key:i},[s("div",{staticClass:"tab-title",attrs:{slot:"title"},slot:"title"},[t._v("\n\t\t\t\t\t"+t._s(e.status_cn)+" "),e.num>0?s("span",{staticClass:"order-num"},[t._v(t._s(e.num))]):t._e()]),t._v(" "),s("van-pull-refresh",{on:{refresh:function(e){t.onPullDownRefresh()}},model:{value:t.isRefresh,callback:function(e){t.isRefresh=e},expression:"isRefresh"}},[t.records.empty?s("div",{staticClass:"no-data"},[s("img",{attrs:{src:"static/img/order_no_con.png",alt:""}}),t._v(" "),1==t.filter.items.status?[1==t.deliveryer.work_status?[1==t.deliveryer.is_errander?[t.can_collect_order?[s("p",[t._v("暂无待抢的跑腿订单")])]:[s("p",[t._v("当前调度模式不允许抢单,请等待管理员或系统派单")])]]:[s("p",[t._v("您没有跑腿单配送权限，请联系管理员")])]]:[s("p",[t._v("您当前处于收工状态,不能抢单")])]]:[s("p",[t._v("暂无符合条件的跑腿订单")])]],2):s("van-list",{attrs:{finished:t.records.finished,offset:100,"immediate-check":!1},on:{load:t.onLoad},model:{value:t.records.loading,callback:function(e){t.$set(t.records,"loading",e)},expression:"records.loading"}},t._l(t.records.data,function(e,i){return s("div",{key:e.id,staticClass:"order-item"},[s("div",{staticClass:"van-hairline--bottom flex-lr padding-15-tb padding-10-lr",on:{click:function(s){t.onDetail(e.id)}}},[s("div",{staticClass:"flex"},[s("span",{staticClass:"c-primary font-500 font-18"},[t._v("#"+t._s(e.id))]),t._v(" "),s("div",{staticClass:"distance flex"},[s("div",{staticClass:"img-wrap"},[s("img",{staticClass:"w-100",attrs:{src:"static/img/start.png",alt:""}})]),t._v(" "),s("div",{staticClass:"text"},[t._v("-"+t._s(e.store2deliveryer_distance)+"km-")]),t._v(" "),s("div",{staticClass:"img-wrap"},[s("img",{staticClass:"w-100",attrs:{src:"static/img/ds.png",alt:""}})]),t._v(" "),s("div",{staticClass:"text"},[t._v("-"+t._s(e.store2user_distance)+"km-")]),t._v(" "),s("div",{staticClass:"img-wrap"},[s("img",{staticClass:"w-100",attrs:{src:"static/img/end.png",alt:""}})])])]),t._v(" "),s("span",{staticClass:"c-danger font-15 font-500"},[t._v("¥ "+t._s(e.deliveryer_total_fee))])]),t._v(" "),s("div",{staticClass:"padding-10-lr margin-15-t"},[s("div",{staticClass:"flex-lr"},[s("ul",{staticClass:"order-tags"},[s("li",{staticClass:"handle-type"},[t._v(t._s(e.delivery_collect_type_cn))]),t._v(" "),t._e()]),t._v(" "),2==e.status&&1!=e.delivery_status?s("div",{staticClass:"c-danger flex"},[e.delivery_overtime>0?[t._v("\n\t\t\t\t\t\t\t\t\t\t\t距超时"),s("count-down",{staticClass:"c-danger",attrs:{endTime:e.delivery_overtime}})]:e.delivery_overtime_start>0?[t._v("\n\t\t\t\t\t\t\t\t\t\t\t已超时"),s("count-down",{staticClass:"c-danger",attrs:{startTime:e.delivery_overtime_start}})]:t._e()],2):t._e()])]),t._v(" "),s("ul",{staticClass:"address padding-10-lr",on:{click:function(s){t.onDetail(e.id)}}},[s("li",{staticClass:"flex-lr margin-15-t"},[s("span",{staticClass:"c-primary font-15"},[t._v("物:")]),t._v(" "),s("ul",{staticClass:"address-text"},[s("li",{staticClass:"font-15 font-500"},[t._v(t._s(e.goods_name))])])]),t._v(" "),s("li",{staticClass:"flex-lr margin-15-t"},[s("span",{staticClass:"c-info font-15"},[t._v(t._s("buy"==e.order_type?"买":"取")+":")]),t._v(" "),s("ul",{staticClass:"address-text"},[s("li",{staticClass:"font-15 font-500"},[t._v(t._s(e.buy_address))])])]),t._v(" "),s("li",{staticClass:"flex-lr margin-15-t"},[s("span",{staticClass:"c-primary font-15"},[t._v("送:")]),t._v(" "),s("ul",{staticClass:"address-text"},[s("li",{staticClass:"font-15 font-500 "},[t._v(t._s(e.accept_address))])])])]),t._v(" "),e.note?s("div",{staticClass:"note"},[s("div",{staticClass:"note-title"},[t._v("备注:")]),t._v(" "),s("div",{staticClass:"note-text"},[t._v(t._s(e.note))])]):t._e(),t._v(" "),s("ul",{staticClass:"time padding-10-lr margin-15-t flex-lr"},[s("li",[t._v(t._s(e.addtime_cn)+"下单")]),t._v(" "),s("li",[t._v("配送 "+t._s(e.delivery_time))])]),t._v(" "),s("ul",{staticClass:"btn-group margin-15-t padding-10-lr flex-lr"},[1==e.delivery_status?[s("li",{staticClass:"btn-item bg-warning",on:{click:function(e){t.onChangeOrderStatus(i,"delivery_assign")}}},[t._v("抢单")])]:2==e.delivery_status||3==e.delivery_status?[1==e.transfer_delivery_status?[s("li",{staticClass:"btn-item bg-danger",on:{click:function(e){t.onChangeOrderStatus(i,"direct_transfer_refuse")}}},[t._v("拒绝转单")]),t._v(" "),s("li",{staticClass:"btn-item bg-primary",on:{click:function(e){t.onChangeOrderStatus(i,"direct_transfer_agree")}}},[t._v("接受转单")])]:[e.data&&1==e.data.yinsihao_status?s("li",{staticClass:"btn-item bg-warning",on:{click:function(s){t.onCallCustomer(e.id,e.order_sn)}}},[t._v("联系顾客")]):s("li",{staticClass:"btn-item bg-warning",on:{click:function(s){t.util.jsTel(e.accept_mobile)}}},[t._v("联系顾客")]),t._v(" "),2==e.delivery_status?s("li",{staticClass:"btn-item bg-primary",on:{click:function(e){t.onChangeOrderStatus(i,"delivery_instore")}}},[t._v("确认取货")]):s("li",{staticClass:"btn-item bg-primary",on:{click:function(e){t.onChangeOrderStatus(i,"delivery_success")}}},[t._v("确认送达")])]]:t._e()],2),t._v(" "),1==e.is_pay?s("div",["delivery"!=e.pay_type?s("div",{staticClass:"have-pay"}):"delivery"==e.pay_type?s("div",{staticClass:"delivery-pay"}):t._e()]):t._e()])}))],1)],1)})),t._v(" "),t.failedTips.show?s("failed-tips",{attrs:{failedTips:t.failedTips}}):t._e()],1),t._v(" "),s("van-dialog",{attrs:{"show-cancel-button":"",confirmButtonText:"确认送达"},on:{confirm:function(e){t.onChangeOrderStatus(t.code.orderIndex,"delivery_success")},cancel:function(e){t.code.codeShow=!1}},model:{value:t.code.codeShow,callback:function(e){t.$set(t.code,"codeShow",e)},expression:"code.codeShow"}},[s("van-field",{attrs:{placeholder:"输入收货码","input-align":"center",readonly:""}}),t._v(" "),s("van-field",{attrs:{placeholder:"请输入收货码"},model:{value:t.code.value,callback:function(e){t.$set(t.code,"value",e)},expression:"code.value"}})],1),t._v(" "),s("van-dialog",{attrs:{"show-cancel-button":"",title:"顾客号码保护中","confirm-button-text":"立即联系"},on:{confirm:function(e){t.util.jsTel(t.yinsihao.secret_mobile)}},model:{value:t.yinsihao.status,callback:function(e){t.$set(t.yinsihao,"status",e)},expression:"yinsihao.status"}},[s("div",{staticClass:"padding-15-tb text-center font-16"},[s("span",{staticClass:"font-bold c-default"},[t._v(t._s(t.yinsihao.secret_mobile))]),t._v(" "),s("span",{staticClass:"padding-10-lr"},[t._v("转")]),t._v(" "),s("span",{staticClass:"font-bold c-danger"},[t._v(t._s(t.yinsihao.extension))])]),t._v(" "),s("div",{staticClass:"padding-15-b font-14 c-gray text-center"},[t._v("播打"+t._s(t.yinsihao.secret_mobile)+"接通后，输入"+t._s(t.yinsihao.extension)+"#即可")])])],1)},staticRenderFns:[]};var d=s("VU/8")(c,l,!1,function(t){s("jxxu")},null,null);e.default=d.exports},jxxu:function(t,e){}});