webpackJsonp([10],{jPG2:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var i=e("Cz8s"),a=e("mzkE"),n=e("75NE"),r=e("deIj"),o=e("nZVv"),l={components:{publicHeader:i.a,publicFooter:a.a,countDown:n.a},data:function(){return{tabActive:0,tabs:[{status:3,status_cn:"待抢",num:0},{status:7,status_cn:"待取货",num:0},{status:4,status_cn:"配送中",num:0},{status:5,status_cn:"已完成",num:0}],filter:{items:{status:3}},isRefresh:!1,showPreLoading:!0,records:{page:1,psize:15,loading:!1,finished:!1,empty:!1,data:[]},deliveryer:{},can_collect_order:!1,config:{},yinsihao:{status:!1,secret_mobile:"",extension:""},failedTips:{show:!1,type:"message",tips:"您没有外卖单的配送权限，请联系平台管理员",btnText:"",link:"",position:"absolute"},menufooter:{}}},methods:{onChangeStatus:function(t,s){this.filter.items.status=this.tabs[t].status,this.onLoad(!0)},onLoad:function(t){var s=this;Object(r.b)({vue:s,force:t,url:"delivery/order/takeout/list",recordsName:"orders",data:{menufooter:1,_deliveryerOrderTabType:"takeout"},success:function(t){s.deliveryer=t.deliveryer,s.can_collect_order=t.can_collect_order,s.config=t.config},fail:function(){s.failedTips.show=!0}}),s.util.isDlala()&&(window.apiready=function(){s.util.startLocation({vue:s})})},onCallCustomer:function(t){var s=this;t.data&&1==t.data.yinsihao_status?Object(r.a)({vue:s,url:"yinsihao/yinsihao",data:{order_id:t.id,type:"member",ordersn:t.ordersn},success:function(t){s.yinsihao.secret_mobile=t.data.secret_mobile,s.yinsihao.extension=t.data.extension,s.yinsihao.status=!0}}):s.util.jsTel(t.mobile)},onChangeOrderStatus:function(t,s){Object(o.a)({vue:this,type:s,index:t,from:"list",order:this.records.data[t]})},onDetail:function(t){3!=this.filter.items.status?this.$router.push(this.util.getUrl({path:"pages/order/detail",query:{id:t}})):this.util.$toast("抢单后才能查看详情","",1e3)},onPullDownRefresh:function(){this.onLoad(!0)}},created:function(){this.query=this.$route.query,this.query&&this.query.status&&(this.filter.items.status=this.query.status)},mounted:function(){var t=this;!t.util.getStorage("idtoken")&&t.util.isDlala()?window.apiready=function(){var s=api.getPrefs({sync:!0,key:"idtoken"});s&&t.util.setStorage("idtoken",s),t.onLoad(),setInterval(function(){3==t.filter.items.status&&1==t.config.auto_refresh&&t.onLoad(!0)},15e3)}:(t.onLoad(),setInterval(function(){3==t.filter.items.status&&1==t.config.auto_refresh&&t.onLoad(!0)},15e3)),this.util.imap(),this.util.icloudapi({vue:t,page:"orderTakeout"})}},c={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{attrs:{id:"takeout-list"}},[e("public-header",{attrs:{title:"订单列表"}}),t._v(" "),e("public-footer",{attrs:{showPreLoading:t.showPreLoading,menufooter:t.menufooter}}),t._v(" "),e("div",{staticClass:"content"},[e("van-tabs",{attrs:{color:"#0EC3B3","title-active-color":"#0EC3B3","title-inactive-color":"#000","line-width":80,"line-height":2,"offset-top":46,sticky:"",swipeable:""},on:{change:t.onChangeStatus},model:{value:t.tabActive,callback:function(s){t.tabActive=s},expression:"tabActive"}},t._l(t.tabs,function(s,i){return e("van-tab",{key:i},[e("div",{staticClass:"tab-title",attrs:{slot:"title"},slot:"title"},[t._v("\n\t\t\t\t\t"+t._s(s.status_cn)+" "),s.num>0?e("span",{staticClass:"order-num"},[t._v(t._s(s.num))]):t._e()]),t._v(" "),e("van-pull-refresh",{on:{refresh:function(s){t.onPullDownRefresh()}},model:{value:t.isRefresh,callback:function(s){t.isRefresh=s},expression:"isRefresh"}},[t.records.empty?e("div",{staticClass:"no-data"},[e("img",{attrs:{src:"static/img/order_no_con.png",alt:""}}),t._v(" "),3==t.filter.items.status?[1==t.deliveryer.work_status?[t.deliveryer.perm_takeout>0?[t.can_collect_order?[e("p",[t._v("暂无待抢的订单")])]:[e("p",[t._v("当前调度模式不允许抢单,请等待管理员或系统派单")])]]:[e("p",[t._v("您没有外卖配送权限，请联系管理员")])]]:[e("p",[t._v("您当前处于收工状态,不能抢单")])]]:[e("p",[t._v("暂无符合条件的订单")])]],2):e("van-list",{attrs:{finished:t.records.finished,offset:100,"immediate-check":!1},on:{load:t.onLoad},model:{value:t.records.loading,callback:function(s){t.$set(t.records,"loading",s)},expression:"records.loading"}},t._l(t.records.data,function(s,i){return e("div",{key:s.id,staticClass:"order-item",class:{reserve:1==s.is_reserve}},[e("div",{staticClass:"van-hairline--bottom flex-lr padding-15-tb padding-10-lr",on:{click:function(e){t.onDetail(s.id)}}},[e("div",{staticClass:"flex"},[e("span",{staticClass:"c-primary font-500 font-18 order-sn"},[t._v("#"+t._s(s.serial_sn))]),t._v(" "),e("div",{staticClass:"distance flex"},[e("div",{staticClass:"img-wrap"},[e("img",{staticClass:"w-100",attrs:{src:"static/img/start.png",alt:""}})]),t._v(" "),e("div",{staticClass:"text"},[t._v("-"+t._s(s.store2deliveryer_distance)+"km-")]),t._v(" "),e("div",{staticClass:"img-wrap"},[e("img",{staticClass:"w-100",attrs:{src:"static/img/ds.png",alt:""}})]),t._v(" "),e("div",{staticClass:"text"},[t._v("-"+t._s(s.store2user_distance)+"km-")]),t._v(" "),e("div",{staticClass:"img-wrap"},[e("img",{staticClass:"w-100",attrs:{src:"static/img/end.png",alt:""}})])])]),t._v(" "),e("span",{staticClass:"c-danger font-15 font-500"},[t._v("¥ "+t._s(s.plateform_deliveryer_fee))])]),t._v(" "),e("div",{staticClass:"padding-10-lr margin-15-t"},[e("div",{staticClass:"flex-lr"},[e("ul",{staticClass:"order-tags"},[3!=s.status?e("li",{staticClass:"handle-type"},[t._v(t._s(s.delivery_collect_type_cn))]):t._e(),t._v(" "),t._e()]),t._v(" "),4==s.status&&3!=s.delivery_status?e("div",{staticClass:"c-danger flex"},[s.delivery_overtime>0?[t._v("\n\t\t\t\t\t\t\t\t\t\t\t距超时"),e("count-down",{staticClass:"c-danger",attrs:{endTime:s.delivery_overtime}})]:s.delivery_overtime_start>0?[t._v("\n\t\t\t\t\t\t\t\t\t\t\t已超时"),e("count-down",{staticClass:"c-danger",attrs:{startTime:s.delivery_overtime_start}})]:t._e()],2):t._e()])]),t._v(" "),e("ul",{staticClass:"address padding-10-lr",on:{click:function(e){t.onDetail(s.id)}}},[e("li",{staticClass:"flex-lr margin-15-t"},[e("span",{staticClass:"c-info font-15"},[t._v("取:")]),t._v(" "),e("ul",{staticClass:"address-text"},[e("li",{staticClass:"font-15 font-500"},[t._v(t._s(s.store.title))]),t._v(" "),e("li",{staticClass:"c-gray margin-5-t"},[t._v(t._s(s.store.address))])])]),t._v(" "),e("li",{staticClass:"flex-lr margin-15-t"},[e("span",{staticClass:"c-primary font-15"},[t._v("送:")]),t._v(" "),e("ul",{staticClass:"address-text"},[e("li",{staticClass:"font-15 font-500 "},[t._v(t._s(s.address))])])])]),t._v(" "),s.note?e("div",{staticClass:"note"},[e("div",{staticClass:"note-title"},[t._v("备注:")]),t._v(" "),e("div",{staticClass:"note-text"},[t._v(t._s(s.note))])]):t._e(),t._v(" "),e("ul",{staticClass:"time padding-10-lr margin-15-t flex-lr"},[e("li",[t._v(t._s(s.addtime_cn)+"下单")]),t._v(" "),e("li",[t._v("配送 "+t._s(s.delivery_day)+" "+t._s(s.delivery_time))])]),t._v(" "),e("ul",{staticClass:"btn-group margin-15-t padding-10-lr flex-lr"},[3==s.delivery_status?[e("li",{staticClass:"btn-item bg-warning",on:{click:function(s){t.onChangeOrderStatus(i,"delivery_assign")}}},[t._v("抢单")])]:t._e(),t._v(" "),4==s.delivery_status||7==s.delivery_status||8==s.delivery_status?[1==s.transfer_delivery_status?[e("li",{staticClass:"btn-item bg-danger",on:{click:function(s){t.onChangeOrderStatus(i,"direct_transfer_refuse")}}},[t._v("拒绝转单")]),t._v(" "),e("li",{staticClass:"btn-item bg-primary",on:{click:function(s){t.onChangeOrderStatus(i,"direct_transfer_agree")}}},[t._v("接受转单")])]:[4==s.delivery_status?[s.mobile?e("li",{staticClass:"btn-item bg-warning",on:{click:function(e){t.onCallCustomer(s)}}},[t._v("联系顾客")]):t._e(),t._v(" "),e("li",{staticClass:"btn-item bg-primary",on:{click:function(s){t.onChangeOrderStatus(i,"delivery_success")}}},[t._v("确认送达")])]:[s.store&&s.store.telephone?e("li",{staticClass:"btn-item",on:{click:function(e){t.util.jsTel(s.store.telephone)}}},[t._v("联系商家")]):t._e(),t._v(" "),e("li",{staticClass:"btn-item bg-primary",on:{click:function(s){t.onChangeOrderStatus(i,"delivery_takegoods")}}},[t._v("确认取货")])]]]:t._e()],2),t._v(" "),1==s.is_pay?e("div",["delivery"!=s.pay_type?e("div",{staticClass:"have-pay"}):"delivery"==s.pay_type?e("div",{staticClass:"delivery-pay"}):t._e()]):t._e()])}))],1)],1)})),t._v(" "),t.failedTips.show?e("failed-tips",{attrs:{failedTips:t.failedTips}}):t._e()],1),t._v(" "),e("van-dialog",{attrs:{"show-cancel-button":"",title:"顾客号码保护中","confirm-button-text":"立即联系"},on:{confirm:function(s){t.util.jsTel(t.yinsihao.secret_mobile)}},model:{value:t.yinsihao.status,callback:function(s){t.$set(t.yinsihao,"status",s)},expression:"yinsihao.status"}},[e("div",{staticClass:"padding-15-tb text-center font-16"},[e("span",{staticClass:"font-bold c-default"},[t._v(t._s(t.yinsihao.secret_mobile))]),t._v(" "),e("span",{staticClass:"padding-10-lr"},[t._v("转")]),t._v(" "),e("span",{staticClass:"font-bold c-danger"},[t._v(t._s(t.yinsihao.extension))])]),t._v(" "),e("div",{staticClass:"padding-15-b font-14 c-gray text-center"},[t._v("播打"+t._s(t.yinsihao.secret_mobile)+"接通后，输入"+t._s(t.yinsihao.extension)+"#即可")])])],1)},staticRenderFns:[]};var d=e("VU/8")(l,c,!1,function(t){e("ues6")},null,null);s.default=d.exports},ues6:function(t,s){}});
//# sourceMappingURL=10.0ad7348b67781c1cc773.js.map